var qe=Object.defineProperty;var Le=e=>{throw TypeError(e)};var Je=(e,t,n)=>t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>Je(e,typeof t!="symbol"?t+"":t,n),Ne=(e,t,n)=>t.has(e)||Le("Cannot "+n);var oe=(e,t,n)=>(Ne(e,t,"read from private field"),n?n.call(e):t.get(e)),xe=(e,t,n)=>t.has(e)?Le("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ie=(e,t,n,o)=>(Ne(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);import{g as ue,a as Qe,r as He}from"./navbar.js";import{u as Me}from"./index2.js";let se=0,re=0;function de(e,t){t=Math.floor(t),e.textContent=`${t}`,re=t}const ke=e=>{for(const s of e.children)s.getAnimations().forEach(a=>{a.cancel()});const t=e.getElementsByClassName("change-0")[0],n=e.getElementsByClassName("change-1")[0],o=e.getElementsByClassName("change-2")[0],i=e.getElementsByClassName("change-3")[0];t.classList.replace("change-0","change-3"),n.classList.replace("change-1","change-0"),o.classList.replace("change-2","change-1"),i.classList.replace("change-3","change-2")};function De(e,t,n,o){o??(o=re-se),t??(t="Score");const i=`
		${o>=0?"+":"-"}${Math.abs(o)} - 
		${t}
		${n==null?"":" - "+n.toFixed(3)}
	`;X(e,i),se=re}function X(e,t){const n=e.getElementsByClassName("change-3")[0].children[0];n.textContent=t,n.style.color="",Me({innerEl:n,containerEl:n.parentElement,mode:"boxoneline"}),ke(e)}function Oe(e,t,n){const o=e.getElementsByClassName("change-3")[0].children[0];o.textContent=t,o.style.color=n,Me({innerEl:o,containerEl:o.parentElement,mode:"boxoneline"}),ke(e)}function ze(e){se=0;for(const t of e.children)t.children[0].textContent=""}const Ke="/practice/assets/abort.mp3",Xe="/practice/assets/autobegin.mp3",Ye="/practice/assets/autoend.mp3",Ze="/practice/assets/countdown.mp3",et="/practice/assets/endgame.mp3",tt="/practice/assets/endmatch.mp3",nt="/practice/assets/teleopbegin.mp3",ot="/practice/assets/pickupcontrollers.mp3",it="/practice/assets/results.mp3";class st{constructor(){I(this,"audios",{})}preload(){this.audios.abort=new Audio(Ke),this.audios.autobegin=new Audio(Xe),this.audios.autoend=new Audio(Ye),this.audios.countdown=new Audio(Ze),this.audios.endgame=new Audio(et),this.audios.endmatch=new Audio(tt),this.audios.teleopbegin=new Audio(nt),this.audios.pickupcontrollers=new Audio(ot),this.audios.results=new Audio(it)}playSound(t){this.audios[t]&&this.audios[t].play()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ae=function(e,t){return ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},ae(e,t)};function Re(e,t){ae(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function rt(e){var t=typeof Symbol=="function"&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function at(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),i,s=[],a;try{for(;(t===void 0||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(p){a={error:p}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return s}function ct(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(at(arguments[t]));return e}var Pe=function(){function e(t,n){this.target=n,this.type=t}return e}(),lt=function(e){Re(t,e);function t(n,o){var i=e.call(this,"error",o)||this;return i.message=n.message,i.error=n,i}return t}(Pe),ut=function(e){Re(t,e);function t(n,o,i){n===void 0&&(n=1e3),o===void 0&&(o="");var s=e.call(this,"close",i)||this;return s.wasClean=!0,s.code=n,s.reason=o,s}return t}(Pe);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var dt=function(){if(typeof WebSocket<"u")return WebSocket},pt=function(e){return typeof e<"u"&&!!e&&e.CLOSING===2},O={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},mt=function(){function e(t,n,o){var i=this;o===void 0&&(o={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(s){i._debug("open event");var a=i._options.minUptime,p=a===void 0?O.minUptime:a;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},p),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(c){return i._ws.send(c)}),i._messageQueue=[],i.onopen&&i.onopen(s),i._listeners.open.forEach(function(c){return i._callEventListener(s,c)})},this._handleMessage=function(s){i._debug("message event"),i.onmessage&&i.onmessage(s),i._listeners.message.forEach(function(a){return i._callEventListener(s,a)})},this._handleError=function(s){i._debug("error event",s.message),i._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(s),i._debug("exec error listeners"),i._listeners.error.forEach(function(a){return i._callEventListener(s,a)}),i._connect()},this._handleClose=function(s){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(s),i._listeners.close.forEach(function(a){return i._callEventListener(s,a)})},this._url=t,this._protocols=n,this._options=o,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var t=this._messageQueue.reduce(function(n,o){return typeof o=="string"?n+=o.length:o instanceof Blob?n+=o.size:n+=o.byteLength,n},0);return t+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(t,n){if(t===void 0&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)},e.prototype.reconnect=function(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())},e.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var n=this._options.maxEnqueuedMessages,o=n===void 0?O.maxEnqueuedMessages:n;this._messageQueue.length<o&&(this._debug("enqueue",t),this._messageQueue.push(t))}},e.prototype.addEventListener=function(t,n){this._listeners[t]&&this._listeners[t].push(n)},e.prototype.dispatchEvent=function(t){var n,o,i=this._listeners[t.type];if(i)try{for(var s=rt(i),a=s.next();!a.done;a=s.next()){var p=a.value;this._callEventListener(t,p)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return!0},e.prototype.removeEventListener=function(t,n){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter(function(o){return o!==n}))},e.prototype._debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._options.debug&&console.log.apply(console,ct(["RWS>"],t))},e.prototype._getNextDelay=function(){var t=this._options,n=t.reconnectionDelayGrowFactor,o=n===void 0?O.reconnectionDelayGrowFactor:n,i=t.minReconnectionDelay,s=i===void 0?O.minReconnectionDelay:i,a=t.maxReconnectionDelay,p=a===void 0?O.maxReconnectionDelay:a,c=0;return this._retryCount>0&&(c=s*Math.pow(o,this._retryCount-1),c>p&&(c=p)),this._debug("next delay",c),c},e.prototype._wait=function(){var t=this;return new Promise(function(n){setTimeout(n,t._getNextDelay())})},e.prototype._getNextUrl=function(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){var n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},e.prototype._connect=function(){var t=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,o=n.maxRetries,i=o===void 0?O.maxRetries:o,s=n.connectionTimeout,a=s===void 0?O.connectionTimeout:s,p=n.WebSocket,c=p===void 0?dt():p;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!pt(c))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(f){t._closeCalled||(t._debug("connect",{url:f,protocols:t._protocols}),t._ws=t._protocols?new c(f,t._protocols):new c(f),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},a))})}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new lt(Error("TIMEOUT"),this))},e.prototype._disconnect=function(t,n){if(t===void 0&&(t=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(t,n),this._handleClose(new ut(t,n,this))}catch{}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(t,n){"handleEvent"in n?n.handleEvent(t):n(t)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}();function ht(){return new mt(`ws://${window.location.hostname}:8888`)}const F=ue("timerValues");var $;const D=class D{constructor(t){I(this,"timer");I(this,"startTime",0);I(this,"loop",!1);I(this,"updateTimer",0);I(this,"interval",1e3);this.timer=t,oe(D,$)??Ie(D,$,this)}static getInstance(){return oe(D,$)}setTimer(t,n){this.startTime=Date.now();const o=a=>{this.timer!=null&&(this.timer.textContent=a)};this.stopTimer();const i=a=>{const p=Math.max(0,Math.round((this.startTime-Date.now())/1e3+t));p<=0&&this.stopTimer();const c=je(p);o(c);const f=this.startTime%this.interval,C=Date.now()%this.interval,B=f>C?f-C:this.interval+f-C;this.loop&&s(Math.max(0,B)),a&&a(p)},s=a=>{a??(a=this.interval),this.updateTimer=setTimeout(()=>i(n),a)};s(),i(n),this.loop=!0}stopTimer(){clearTimeout(this.updateTimer),this.loop=!1}getStartTime(){return this.startTime}};$=new WeakMap,xe(D,$);let x=D,W;function Ae(e,t){clearInterval(W);const n=Date.now(),o=i=>{e.textContent=i};W=setInterval(()=>{const i=Math.round(t*1e3+Date.now()-n)/1e3;i>=9999&&clearInterval(W),o(`${i}`)},1),o(t.toFixed(3))}function Fe(e){clearInterval(W),Ae(e,0)}function ce(){clearInterval(W)}function je(e){return(e-(e%=60))/60+(9<e?":":":0")+e}let d;function ft(e){d=e}const gt=e=>{e<=F.teleop&&(d==null||d.playSound("autoend"),pe())};function Be(e){e??(e=F.auto+F.teleop);const t=x.getInstance();t&&t.setTimer(e,gt)}const vt=e=>{var t;switch(e){case 6:d==null||d.playSound("pickupcontrollers");break;case 3:d==null||d.playSound("countdown");break;case 0:d==null||d.playSound("teleopbegin"),me();break}e<0&&((t=x.getInstance())==null||t.stopTimer())};function pe(e){e??(e=F.transition);const t=x.getInstance();t&&t.setTimer(e,vt)}const bt=e=>{var t;switch(e){case F.endgame:d==null||d.playSound("endgame");break;case 0:d==null||d.playSound("endmatch");break}e<=0&&((t=x.getInstance())==null||t.stopTimer())};function me(e){e??(e=F.teleop);const t=x.getInstance();t&&t.setTimer(e,bt)}let M=!1;const yt=ue("layout"),_t=Qe(yt),Y=_t.layoutDataGetter();let le="";typeof Y.stylePath=="object"?Y.stylePath.forEach(e=>{le+=`<link rel="stylesheet" href="${e}">`}):le=`<link rel="stylesheet" href="${Y.stylePath}">`;document.querySelector("#app").innerHTML=le+Y.html.timer;He(document.querySelector("nav"));document.addEventListener("click",()=>{console.log("")});const k=new st;k.preload();ft(k);const Ge=document.getElementById("timer"),Z=new x(Ge),b=ue("timerValues");Ge.textContent=je(b.auto+b.teleop);const he=document.getElementById("cycle-timer"),fe=document.getElementById("score"),N=document.getElementById("changes-box"),Et=e=>{const t=document.getElementById("saveModal"),n=document.getElementById("modalHeader"),o=document.getElementById("modalContent");t.classList.add("shownModal"),o.scrollTop=0,o.innerHTML="",n.textContent="Save run";const i=o.appendChild(document.createElement("form")),s=i.appendChild(document.createElement("label"));s.id="runNameInputLabel",s.setAttribute("for","runNameInput"),s.textContent="Run name";const a=i.appendChild(document.createElement("input"));a.id="runNameInput",a.setAttribute("type","text"),a.setAttribute("placeholder","Run name");const p=i.appendChild(document.createElement("p"));p.id="runNameNote",p.textContent="Leave empty to discard run";const c=i.appendChild(document.createElement("input"));c.id="runNameSubmit",c.setAttribute("type","submit"),c.value="Submit",c.addEventListener("click",r=>{r.preventDefault();const l=f();l.name=a.value,Tt(l),Ve()});const f=()=>{const r=_.valueAsNumber;let l;isNaN(r)?l=new Date(_.placeholder):l=new Date(r+q.getTimezoneOffset()*60*1e3);let v=0;const L={},m=[];for(let y=0;y<G.length;y++){const w=G[y],z=Q[y],K=H[y];if(w.value.trim().length<=0&&w.placeholder.trim().length<=0||z.value.trim().length<=0&&z.placeholder.trim().length<=0||K.value.trim().length<=0&&K.placeholder.trim().length<=0)continue;let V=Number(w.value),U=z.value,A=Number(K.value);(isNaN(V)||!isFinite(V)||V<=0)&&(V=Number(w.placeholder)),U.trim().length==0&&(U=z.placeholder),(isNaN(A)||!isFinite(A)||!Number.isInteger(A))&&(A=Number(K.placeholder)),v+=A,L[U]=(L[U]??0)+1,m.push({time:V,type:U,score:A})}let g=[],u=Number(E.value),h=Number(T.value);return(isNaN(u)||!isFinite(u))&&(u=Number(E.placeholder)),(isNaN(h)||!isFinite(h))&&(h=Number(T.placeholder)),T.value.trim().length!=0?g=[Math.floor((isNaN(u)?0:u)*1e3),Math.floor(h*1e3)]:E.value.trim().length!=0&&(g=[Math.floor(u)*1e3]),{name:e.name,timestamp:Math.floor(l.getTime()/1e3),score:v,info:L,cycles:m,teleopTimes:g,startingMatchPeriod:e.startingMatchPeriod}},C=r=>{be.textContent="";for(const l in r.info){const v=be.appendChild(document.createElement("li"));v.textContent=`${l}: ${r.info[l]}`}if(P.textContent="",r.cycles.length>0){const l=r.cycles.map(y=>y.time),v=l.reduce((y,w)=>Math.min(y,w)),L=l.reduce((y,w)=>Math.max(y,w)),m=l.reduce((y,w)=>y+w),g=m/l.length,u=m/r.score,h=r.score/m;P.appendChild(document.createElement("li")).textContent=`Min: ${v.toFixed(3)}s`,P.appendChild(document.createElement("li")).textContent=`Max: ${L.toFixed(3)}s`,P.appendChild(document.createElement("li")).textContent=`Mean: ${g.toFixed(3)}s`,P.appendChild(document.createElement("li")).textContent=`Secs/point: ${u.toFixed(3)}s`,P.appendChild(document.createElement("li")).textContent=`Points/sec: ${h.toFixed(3)}`}};let B=o.appendChild(document.createElement("h2"));B=B.appendChild(document.createElement("u")),B.textContent="Info";const ge=o.appendChild(document.createElement("div")),ve=ge.appendChild(document.createElement("h3")),_=ge.appendChild(document.createElement("input"));ve.className="modalContentSubtitle editModalSubtitle",_.type="datetime-local",_.id="editModalDate",_.classList.add("editModalInput");const q=new Date(Math.floor(Date.now()/1e3)*1e3);ve.textContent="Date: ",_.valueAsNumber=q.getTime()-q.getTimezoneOffset()*60*1e3,_.placeholder=q.toString(),_.addEventListener("focusout",()=>{const r=_.valueAsNumber;isNaN(r)?_.classList.add("invalid"):_.classList.remove("invalid")});const be=o.appendChild(document.createElement("ul")),Ue=o.appendChild(document.createElement("h2")).appendChild(document.createElement("u"));Ue.textContent="Cycles";const S=o.appendChild(document.createElement("table"));S.id="cycleTable",S.className="editCycleTable";const J=S.appendChild(document.createElement("tr"));let R=J.appendChild(document.createElement("th"));R=J.appendChild(document.createElement("th")),R.textContent="Time (s)",R=J.appendChild(document.createElement("th")),R.textContent="Type",R=J.appendChild(document.createElement("th")),R.textContent="Score";const G=[],Q=[],H=[],ye=r=>{const l=S.appendChild(document.createElement("tr"));let v=l.appendChild(document.createElement("td"));const L=v.appendChild(document.createElement("button"));L.classList.add("editModalDeleteButton"),v=l.appendChild(document.createElement("td"));const m=v.appendChild(document.createElement("input"));m.classList.add("editModalInput","editModalTableInput"),G.push(m),m.value=(r==null?void 0:r.time.toString())??"",m.placeholder=(r==null?void 0:r.time.toString())??"",v=l.appendChild(document.createElement("td"));const g=v.appendChild(document.createElement("input"));g.classList.add("editModalInput","editModalTableInput"),Q.push(g),g.value=(r==null?void 0:r.type)??"",g.placeholder=(r==null?void 0:r.type)??"",v=l.appendChild(document.createElement("td"));const u=v.appendChild(document.createElement("input"));u.classList.add("editModalInput","editModalTableInput"),H.push(u),u.value=(r==null?void 0:r.score.toString())??"",u.placeholder=(r==null?void 0:r.score.toString())??"",L.addEventListener("click",()=>{S.removeChild(l),G.splice(G.indexOf(m),1),Q.splice(Q.indexOf(g),1),H.splice(H.indexOf(u),1),C(f())}),m.addEventListener("focusout",()=>{const h=Number(m.value);(isNaN(h)||!isFinite(h)||h<=0)&&m.value.length>0?m.classList.add("invalid"):m.classList.remove("invalid"),C(f())}),g.addEventListener("focusout",()=>{const h=g.value;h.trim().length==0&&h.length>0?g.classList.add("invalid"):g.classList.remove("invalid"),C(f())}),u.addEventListener("focusout",()=>{const h=Number(u.value);(isNaN(h)||!isFinite(h)||!Number.isInteger(h))&&u.value.length>0?u.classList.add("invalid"):u.classList.remove("invalid"),C(f())})};for(const r of e.cycles)ye(r);const ee=S.appendChild(document.createElement("tr")),_e=ee.appendChild(document.createElement("td")).appendChild(document.createElement("button"));_e.classList.add("editModalAddButton"),_e.addEventListener("click",()=>{S.removeChild(ee),ye(),S.appendChild(ee),C(f())});const Ee=o.appendChild(document.createElement("h3"));Ee.className="modalContentSubtitle",Ee.textContent="Statistics";const P=o.appendChild(document.createElement("ul"));e.teleopTimes??(e.teleopTimes=[]);const We=e.startingMatchPeriod=="AUTO"?b.auto+b.transition:e.startingMatchPeriod=="TRANSITION"?b.transition:0,Te=e.periodTimes[0]==null||e.periodTimes[1]==null?null:(e.periodTimes[1]-e.periodTimes[0])/1e3-We;Te!=null&&(e.teleopTimes[0]=Math.floor(Te*1e3));const Ce=e.periodTimes[1]==null||e.periodTimes[2]==null?null:(e.periodTimes[2]-e.periodTimes[1])/1e3-b.teleop;Ce!=null&&(e.teleopTimes[1]=Math.floor(Ce*1e3));const $e=o.appendChild(document.createElement("h2")).appendChild(document.createElement("u"));$e.textContent="TeleOp Times";const te=o.appendChild(document.createElement("div"));te.classList.add("editModalTeleopLine"),te.textContent="TeleOp start: ";const E=te.appendChild(document.createElement("input"));E.classList.add("editModalInput");const we=e.teleopTimes[0]!=null?(e.teleopTimes[0]/1e3).toFixed(3):"";E.value=we,E.placeholder=we,E.addEventListener("focusout",()=>{const r=Number(E.value);(isNaN(r)||!isFinite(r))&&E.value.trim().length>0?E.classList.add("invalid"):E.classList.remove("invalid")});const ne=o.appendChild(document.createElement("div"));ne.classList.add("editModalTeleopLine"),ne.textContent="TeleOp end: ";const T=ne.appendChild(document.createElement("input"));T.classList.add("editModalInput");const Se=e.teleopTimes[1]!=null?(e.teleopTimes[1]/1e3).toFixed(3):"";T.value=Se,T.placeholder=Se,T.addEventListener("focusout",()=>{const r=Number(T.value);(isNaN(r)||!isFinite(r))&&T.value.trim().length>0?T.classList.add("invalid"):T.classList.remove("invalid")}),C(f())},Ve=()=>{const e=document.getElementById("saveModal");e!=null&&e.classList.remove("shownModal")},Tt=e=>{if(e.name!="")if(j.readyState==WebSocket.OPEN){const t={event:"saveRun",name:JSON.stringify(e)};j.send(JSON.stringify(t))}else console.error("Run could not be saved. Disconnected from WS")},Ct=e=>{if(M=e.running,!e.running)return;const t=e.matchPeriod,n=e.periodTime;let o;switch(t){case"AUTO":o=b.auto+b.teleop,Be(o-n);break;case"TRANSITION":o=b.transition,pe(o-n);break;case"TELEOP":o=b.teleop,me(o-n);break;default:Z.setTimer(0);break}de(fe,e.score),e.cycles.forEach(i=>{De(N,i.type,i.time,i.score)}),Ae(he,e.cycleTime)},ie=()=>{de(fe,0),ze(N),Fe(he),Ve()},j=ht();j.onopen=()=>{j.send(JSON.stringify({event:"getState"}))};j.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch{console.error(`Invalid socket message received. Got "${e.data}"`);return}wt(t)};j.onclose=()=>{Z.stopTimer(),ce()};const wt=e=>{switch(console.debug(e),e.event){case"setState":if(e.name){console.log("Received run state, updating info");let t;try{t=JSON.parse(e.name)}catch{console.error(`Invalid state JSON received. Got "${e.name}"`);break}Ct(t)}break;case"startAuto":M=!0,Be(),k.playSound("autobegin"),ie();break;case"startTransition":M=!0,pe(),k.playSound("autoend"),ie();break;case"startTeleop":if(M||(M=!0,me(),k.playSound("teleopbegin"),ie()),e.name&&e.value){e.value/=1e3;const t=e.name=="AUTO"?b.auto+b.transition:e.name=="TRANSITION"?b.transition:0,n=e.value-t,o=n>0;Oe(N,"TeleOp started: "+(o?"+":"-")+Math.abs(n).toFixed(3),o?"var(--failure-color)":"var(--success-color)")}else X(N,"TeleOp started");break;case"abort":M=!1,k.playSound("abort"),Z.stopTimer(),ce();break;case"resetCycle":Fe(he),De(N,e.name,(e.value??0)/1e3);break;case"setScore":Object.prototype.hasOwnProperty.call(e,"value")&&de(fe,e.value);break;case"playSound":e.name&&k.playSound(e.name);break;case"end":if(M=!1,Z.stopTimer(),ce(),e.name){const t=JSON.parse(e.name),n=t.periodTimes[1]==null||t.periodTimes[2]==null?null:(t.periodTimes[2]-t.periodTimes[1])/1e3-b.teleop;if(n!=null){const o=n>0;Oe(N,"TeleOp ended: "+(n>0?"+":"-")+Math.abs(n).toFixed(3),o?"var(--failure-color)":"var(--success-color)")}else X(N,"Run ended");Et(t)}else X(N,"Run ended");break;case"error":e.name?console.error(`[SERVER] ${e.name}`):console.error("[SERVER] An unknown error has occurred");break;default:console.error("Unknown event received");break}};
